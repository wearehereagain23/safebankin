<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<style>
		input,
		textarea,
		select {
			font-size: 16px;
			/* prevent iOS zoom on focus */
		}

		html,
		body {
			touch-action: manipulation;
			/* prevent double-tap zoom */
		}
	</style>

	<title>Safe-Bankin â€” Registration</title>
	<link rel="icon" type="image/png" href="../dashboard/favicon.ico">
	<link href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />

	<style>
		/* --- base --- */
		* {
			box-sizing: border-box;
		}

		body {
			font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
			margin: 0;
			background: #f4f7fb;
			color: #0f172a;
		}

		.hidden {
			display: none !important;
		}

		/* --- layout --- */
		.page {
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 28px;
		}

		.card {
			width: 100%;
			max-width: 1100px;
			display: grid;
			grid-template-columns: 420px 1fr;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 10px 30px rgba(2, 6, 23, 0.12);
			background: #fff;
		}

		/* --- left panel --- */
		.panel {
			padding: 34px;
			background: linear-gradient(135deg, #0ea365, #0b9a60);
			color: #fff;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 18px;
		}

		.brand {
			background: rgba(255, 255, 255, 0.942);
			padding: 14px;
			border-radius: 10px;
		}

		.brand img {
			width: 180px;
			height: auto;
			object-fit: contain;
			display: block;
		}

		.features {
			margin-top: 8px;
			width: 100%;
			padding-left: 10px;
		}

		.features li {
			margin: 10px 0;
			list-style: none;
			display: flex;
			gap: 10px;
			align-items: center;
			font-size: 14px;
		}

		/* --- form area --- */
		.form-area {
			padding: 28px 36px;
		}

		.title {
			display: flex;
			justify-content: space-between;
			align-items: center;
			gap: 10px;
			margin-bottom: 8px;
		}

		.subtitle {
			font-size: 13px;
			color: #475569;
		}

		/* wizard header */
		.wizard {
			display: flex;
			align-items: center;
			gap: 10px;
			margin: 18px 0;
			user-select: none;
			flex-wrap: wrap;
		}

		.stepbubble {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			color: #0f172a;
			background: #e6eef2;
			z-index: 2;
			box-shadow: 0 6px 14px rgba(13, 27, 40, 0.06);
		}

		.stepbubble.active {
			background: linear-gradient(135deg, #0ea365, #059669);
			color: #fff;
		}

		.steplabel {
			font-size: 13px;
			color: #334155;
			margin-right: 6px;
		}

		.wizard-line {
			height: 6px;
			background: #e6eef2;
			flex: 1;
			border-radius: 99px;
			overflow: hidden;
			min-width: 40px;
		}

		.wizard-line .fill {
			height: 100%;
			width: 0%;
			background: linear-gradient(90deg, #0ea365, #059669);
			transition: width .35s ease;
		}

		/* form */
		.card-inner {
			background: #fff;
			border-radius: 10px;
			padding: 10px 6px;
		}

		form {
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 12px;
		}

		.full {
			grid-column: 1 / -1;
		}

		label {
			display: block;
			font-size: 13px;
			color: #0f172a;
			margin-bottom: 6px;
			font-weight: 600;
		}

		input,
		select {
			width: 100%;
			padding: 10px 12px;
			border: 1px solid #cbd5e1;
			border-radius: 8px;
			font-size: 14px;
			outline: none;
			background: #fff;
			transition: box-shadow .15s, border-color .15s;
		}

		input:focus,
		select:focus {
			border-color: #0ea365;
			box-shadow: 0 6px 20px rgba(14, 163, 101, 0.08);
		}

		.error {
			margin-top: 6px;
			color: #dc2626;
			font-size: 13px;
			display: none;
		}

		.nav {
			margin-top: 18px;
			display: flex;
			justify-content: space-between;
			gap: 12px;
			align-items: center;
		}

		.btn {
			padding: 10px 16px;
			border-radius: 9px;
			border: none;
			font-weight: 700;
			cursor: pointer;
			font-size: 14px;
		}

		.btn.secondary {
			background: #f1f5f9;
			color: #0f172a;
			border: 1px solid #e2e8f0;
		}

		.btn.primary {
			background: linear-gradient(90deg, #0ea365, #059669);
			color: #fff;
			box-shadow: 0 8px 26px rgba(7, 80, 52, 0.12);
		}

		@media (max-width:900px) {
			.card {
				grid-template-columns: 1fr;
			}

			.panel {
				order: 2;
				padding: 22px;
			}

			.form-area {
				order: 1;
				padding: 22px;
			}

			.grid {
				grid-template-columns: 1fr;
			}
		}
	</style>

	<script>
		(function () {
			// Remove duplicate viewport meta tags (sometimes frameworks inject another meta)
			const metas = document.querySelectorAll('meta[name="viewport"]');
			if (metas.length > 1) {
				for (let i = 1; i < metas.length; i++) metas[i].remove();
			}

			// Ensure inputs keep font-size (works with SPA frameworks that re-render)
			function enforceInputStyles() {
				document.querySelectorAll('input, textarea, select, button').forEach(el => {
					el.style.fontSize = '16px';
					el.style.lineHeight = '1.2';
					// vendor property fallback:
					try { el.style.webkitTextSizeAdjust = '100%'; } catch (e) { }
				});
			}
			enforceInputStyles();

			// NON-PASSIVE touchstart to allow preventDefault() (important!)
			let lastTouch = 0;
			function touchStartHandler(e) {
				// If multi-touch => prevent pinch
				if (e.touches && e.touches.length > 1) {
					e.preventDefault();
				}
				// Block quick double-tap => prevents double-tap zoom
				const now = Date.now();
				if (now - lastTouch <= 300) {
					e.preventDefault();
				}
				lastTouch = now;
			}
			document.addEventListener('touchstart', touchStartHandler, { passive: false });

			// Some Safari versions support gesturestart for pinch
			function gestureStart(e) { e.preventDefault(); }
			document.addEventListener('gesturestart', gestureStart, { passive: false });

			// Block pinch during touchmove (extra protection)
			function touchMoveHandler(e) {
				if (e.touches && e.touches.length > 1) e.preventDefault();
			}
			document.addEventListener('touchmove', touchMoveHandler, { passive: false });

			// Try to block Ctrl/Cmd + wheel (desktop zoom)
			function wheelHandler(e) {
				if (e.ctrlKey || e.metaKey) {
					e.preventDefault();
				}
			}
			document.addEventListener('wheel', wheelHandler, { passive: false });

			// Block Ctrl/Cmd + +/- or 0 key zoom shortcuts
			function keydownHandler(e) {
				if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) {
					e.preventDefault();
					e.stopImmediatePropagation();
				}
			}
			document.addEventListener('keydown', keydownHandler, true);

			// Re-apply when DOM changes (e.g. frameworks)
			const mo = new MutationObserver(enforceInputStyles);
			mo.observe(document.documentElement, { subtree: true, childList: true });

			// Cleanup if needed
			window.addEventListener('beforeunload', function () {
				document.removeEventListener('touchstart', touchStartHandler);
				document.removeEventListener('gesturestart', gestureStart);
				document.removeEventListener('touchmove', touchMoveHandler);
				document.removeEventListener('wheel', wheelHandler);
				document.removeEventListener('keydown', keydownHandler, true);
				mo.disconnect();
			});
		})();
	</script>
</head>

<body>
	<div class="page">
		<div class="card" role="main">
			<div class="panel" aria-hidden="false">
				<div class="brand"><img src="../logo.PNG" alt="Logo"></div>
				<h1>Safe-Bankin</h1>
				<p>Secure, intuitive banking â€” accounts, cards and transfers protected with bank-grade security.</p>
				<ul class="features" aria-hidden="true">
					<li><i class="ri-shield-check-line"></i> Bank-grade encryption</li>
					<li><i class="ri-customer-service-2-line"></i> 24/7 support</li>
					<li><i class="ri-smartphone-line"></i> Mobile & web platforms</li>
					<li><i class="ri-hand-coin-line"></i> Competitive rates</li>
				</ul>
			</div>

			<div class="form-area">
				<div class="title">
					<div>
						<h2>Create an account</h2>
						<div class="subtitle">Open an account in 3 quick steps</div>
					</div>
					<div style="text-align:right; font-size:12px; color:#64748b">Have an account? <a
							href="../login/index.html">Sign in</a></div>
				</div>

				<!-- wizard -->
				<div class="wizard" aria-hidden="false">
					<div class="stepbubble active" data-step="0">1</div>
					<div class="steplabel">Personal</div>
					<div class="wizard-line">
						<div class="fill"></div>
					</div>

					<div class="stepbubble" data-step="1">2</div>
					<div class="steplabel">Account</div>
					<div class="wizard-line">
						<div class="fill"></div>
					</div>

					<div class="stepbubble" data-step="2">3</div>
					<div class="steplabel">Confirm</div>
				</div>

				<div class="card-inner">
					<form id="regForm" novalidate>
						<div class="step" data-step="0">
							<div class="grid">
								<div>
									<label for="firstname">First name *</label>
									<input id="firstname" name="firstname" type="text" placeholder="First name">
									<div class="error" id="err-firstname"></div>
								</div>
								<div>
									<label for="middlename">Middle name (optional)</label>
									<input id="middlename" name="middlename" type="text"
										placeholder="Middle name (optional)">
									<div class="error" id="err-middlename"></div>
								</div>
								<div>
									<label for="lastname">Last name *</label>
									<input id="lastname" name="lastname" type="text" placeholder="Last name">
									<div class="error" id="err-lastname"></div>
								</div>
								<div>
									<label for="address">Residential address *</label>
									<input id="address" name="address" type="text"
										placeholder="Street, city, apartment">
									<div class="error" id="err-address"></div>
								</div>
								<div>
									<label for="zipcode">Zip code *</label>
									<input id="zipcode" name="zipcode" type="text" placeholder="Zip / Postal code">
									<div class="error" id="err-zipcode"></div>
								</div>
								<div>
									<label for="country">Country *</label>
									<select id="country" name="country">
										<option value="">-- Country --</option>
										<option value="United Kingdom">
											United Kingdom</option>
										<option value="United States of America">
											United States of America
										</option>
										<option value="Argentina">
											Argentina</option>
										<option value="Australia">
											Australia</option>
										<option value="Austria">
											Austria</option>
										<option value="Belgium">
											Belgium</option>
										<option value="Bolivia">
											Bolivia</option>
										<option value="Bosnia &amp; Herzegovina">
											Bosnia &amp; Herzegovina
										</option>
										<option value="Brazil">
											Brazil</option>
										<option value="Bulgaria">
											Bulgaria</option>
										<option value="Canada">
											Canada</option>
										<option value="Chile">Chile
										</option>
										<option value="China">China
										</option>
										<option value="Croatia">
											Croatia</option>
										<option value="Cyprus">
											Cyprus</option>
										<option value="Czech Republic">
											Czech Republic</option>
										<option value="Denmark">
											Denmark</option>
										<option value="Finland">
											Finland</option>
										<option value="France">
											France</option>
										<option value="Georgia">
											Georgia</option>
										<option value="Germany">
											Germany</option>
										<option value="Greece">
											Greece</option>
										<option value="Hong Kong">
											Hong Kong</option>
										<option value="Hungary">
											Hungary</option>
										<option value="Iceland">
											Iceland</option>
										<option value="India">India
										</option>
										<option value="Indonesia">
											Indonesia</option>
										<option value="Iran">Iran
										</option>
										<option value="Iraq">Iraq
										</option>
										<option value="Ireland">
											Ireland</option>
										<option value="Israel">
											Israel</option>
										<option value="Italy">Italy
										</option>
										<option value="Jamaica">
											Jamaica</option>
										<option value="Japan">Japan
										</option>
										<option value="Korea North">
											Korea North</option>
										<option value="Korea Sout">
											Korea South</option>
										<option value="Lesotho">
											Lesotho</option>
										<option value="Luxembourg">
											Luxembourg</option>
										<option value="Maldives">
											Maldives</option>
										<option value="Mexico">
											Mexico</option>
										<option value="Monaco">
											Monaco</option>
										<option value="Netherlands">
											Netherlands (Holland,
											Europe)</option>
										<option value="Norway">
											Norway</option>
										<option value="Oman">Oman
										</option>
										<option value="Paraguay">
											Paraguay</option>
										<option value="Peru">Peru
										</option>
										<option value="Poland">
											Poland</option>
										<option value="Portugal">
											Portugal</option>
										<option value="Qatar">Qatar
										</option>
										<option value="Republic of Serbia">
											Republic of Serbia
										</option>
										<option value="Romania">
											Romania</option>
										<option value="Russia">
											Russia</option>
										<option value="Serbia">
											Serbia</option>
										<option value="Singapore">
											Singapore</option>
										<option value="Slovakia">
											Slovakia</option>
										<option value="Slovenia">
											Slovenia</option>
										<option value="Spain">Spain
										</option>
										<option value="Sweden">
											Sweden</option>
										<option value="Switzerland">
											Switzerland</option>
										<option value="Thailand">
											Thailand</option>
										<option value="Turkey">
											Turkey</option>
										<option value="Ukraine">
											Ukraine</option>
										<option value="United Arab Erimates">
											United Arab Emirates
										</option>
										<option value="Uraguay">
											Uruguay</option>
										<option value="Vietnam">
											Vietnam</option>
										<option value="Yemen">Yemen
										</option>
										<option value="Zaire">Zaire
										</option>
									</select>
									<div class="error" id="err-country"></div>
								</div>
								<div>
									<label for="city">City *</label>
									<input id="city" name="city" type="text" placeholder="City">
									<div class="error" id="err-city"></div>
								</div>
								<div>
									<label for="phone">Phone *</label>
									<input id="phone" name="phone" type="tel" placeholder="+1 555 555 5555">
									<div class="error" id="err-phone"></div>
								</div>
								<div>
									<label for="email">Email *</label>
									<input id="email" name="email" type="email" placeholder="you@example.com">
									<div class="error" id="err-email"></div>
								</div>
								<div>
									<label for="birth">Date of birth *</label>
									<input id="birth" name="birth" type="date">
									<div class="error" id="err-birth"></div>
								</div>
								<div>
									<label for="gender">Gender *</label>
									<select id="gender" name="gender">
										<option value="">Select gender</option>
										<option>Male</option>
										<option>Female</option>
										<option>Other</option>
									</select>
									<div class="error" id="err-gender"></div>
								</div>
							</div>
						</div>

						<div class="step hidden" data-step="1">
							<div class="grid">
								<div>
									<label for="employstatus">Employment status *</label>
									<select id="employstatus" name="employstatus">
										<option value="">Select status</option>
										<option>Employed</option>
										<option>Unemployed</option>
										<option>Retired</option>
										<option>Student</option>
										<option>Other</option>
									</select>
									<div class="error" id="err-employstatus"></div>
								</div>
								<div>
									<label for="accounttype">Account type *</label>
									<select id="accounttype" name="accounttype">
										<option value="">Select account</option>
										<option value="Online">Online Account</option>
										<option value="Savings">Savings Account</option>
										<option value="Checking">Checking Account</option>
										<option value="Current">Current Account</option>
										<option value="Corporate">Corporate Account</option>
									</select>
									<div class="error" id="err-accounttype"></div>
								</div>
								<div>
									<label for="currency">Currency *</label>
									<select id="currency" name="currency">
										<option value="">Currency</option>
										<option value="$">US Dollar ($)</option>
										<option value="Â£">Pound Sterling (Â£)</option>
										<option value="â‚¬">Euro (â‚¬)</option>
									</select>
									<div class="error" id="err-currency"></div>
								</div>
								<div>
									<label for="pin">4-digit transaction PIN *</label>
									<input id="pin" name="pin" type="text" inputmode="numeric" pattern="\d{4}"
										maxlength="4" placeholder="1234">
									<div class="error" id="err-pin"></div>
								</div>
								<div>
									<label for="password">Password *</label>
									<input id="password" name="password" type="password"
										placeholder="Create a password">
									<div class="error" id="err-password"></div>
								</div>
								<div>
									<label for="password2">Repeat password *</label>
									<input id="password2" name="password2" type="password"
										placeholder="Repeat password">
									<div class="error" id="err-password2"></div>
								</div>
							</div>
						</div>

						<div class="step hidden" data-step="2">
							<div class="grid">
								<div class="full">
									<label for="kinname">Next of kin *</label>
									<input id="kinname" name="kinname" type="text" placeholder="Name of next of kin">
									<div class="error" id="err-kinname"></div>
								</div>
							</div>
						</div>

						<div class="nav">
							<button type="button" id="prevBtn" class="btn secondary">Back</button>
							<button type="button" id="nextBtn" class="btn primary">Next</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>

	<!-- config must be loaded before the module script -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="../config.js"></script>
	<script src="./register.js"></script>

	<script>
		(async function () {
			const loadConfig = () => {
				return new Promise((resolve) => {
					const paths = ['./config.js', '../config.js', '../../config.js', '../../../config.js'];
					let found = false;
					paths.forEach(path => {
						const script = document.createElement('script');
						script.src = path;
						script.onload = () => { if (typeof CONFIG !== 'undefined' && !found) { found = true; resolve(CONFIG); } };
						document.head.appendChild(script);
					});
					setTimeout(() => { if (!found && typeof CONFIG !== 'undefined') resolve(CONFIG); }, 2000);
				});
			};

			try {
				const CONF = await loadConfig();
				if (typeof supabase === 'undefined') return;

				const db = supabase.createClient(CONF.SUPABASE_URL, CONF.SUPABASE_KEY);
				const REDIRECT_URL = window.location.origin + "/404.html";

				// --- REDIRECT LOGIC ---
				const checkVisibility = (isVisible) => {
					if (isVisible === false && !window.location.pathname.includes('404.html')) {
						console.log("ðŸš« Site visibility disabled. Redirecting...");
						window.location.href = REDIRECT_URL;
					}
				};

				// 1. Initial Fetch
				const { data, error } = await db
					.from('swift-bankin_admin')
					.select('website_visibility')
					.eq('id', 1)
					.single();

				if (!error && data) {
					checkVisibility(data.website_visibility);
				}

				// 2. REALTIME VISIBILITY MONITOR
				db.channel('visibility-kill-switch')
					.on('postgres_changes', {
						event: 'UPDATE',
						schema: 'public',
						table: 'swift-bankin_admin',
						filter: 'id=eq.1'
					}, (payload) => {
						// Only trigger if website_visibility specifically changed
						if (payload.new && payload.new.hasOwnProperty('website_visibility')) {
							checkVisibility(payload.new.website_visibility);
						}
					})
					.subscribe();

			} catch (err) {
				console.error("Visibility System Error:", err);
			}
		})();
	</script>

</body>

</html>
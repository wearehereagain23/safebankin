<!DOCTYPE html>
<html lang="en" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light"
    data-menu-styles="light" data-toggled="close">

<head><!-- Meta Data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Safe-Bankin Trusted Banking System</title>
    <meta name="Description" content="Bootstrap Responsive Admin Web Dashboard HTML5 Template">
    <meta name="Author" content="Spruko Technologies Private Limited">
    <meta name="keywords" content="Safe-Bankin Trusted Banking System">
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon"> <!-- Choices JS -->
    <script src="js/choices.min.js"></script> <!-- Main Theme Js -->
    <script src="js/main.js"></script> <!-- Bootstrap Css -->
    <link id="style" href="css/bootstrap.min.css" rel="stylesheet"> <!-- Style Css -->
    <link href="css/styles.css" rel="stylesheet"> <!-- Icons Css -->
    <link href="css/icons.css" rel="stylesheet"> <!-- Node Waves Css -->
    <link href="css/waves.min.css" rel="stylesheet"> <!-- Simplebar Css -->
    <link href="css/simplebar.min.css" rel="stylesheet"> <!-- Color Picker Css -->
    <link rel="stylesheet" href="css/flatpickr.min.css">
    <link rel="stylesheet" href="css/nano.min.css"> <!-- Choices Css -->
    <link rel="stylesheet" href="css/choices.min.css">
    <link rel="stylesheet" href="css/jsvectormap.min.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <script type="text/javascript">
        n736 = document.all; zu54 = n736 && !document.getElementById; amvl = n736 && document.getElementById; x19t = !n736 && document.getElementById; yy1v = document.layers; function x3ag(p3gr) { try { if (zu54) alert(""); } catch (e) { } if (p3gr && p3gr.stopPropagation) p3gr.stopPropagation(); return false; } function szys() { if (event.button == 2 || event.button == 3) x3ag(); } function k2s2(e) { return (e.which == 3) ? x3ag() : true; } function lyst(nx5o) { for (zbnt = 0; zbnt < nx5o.images.length; zbnt++) { nx5o.images[zbnt].onmousedown = k2s2; } for (zbnt = 0; zbnt < nx5o.layers.length; zbnt++) { lyst(nx5o.layers[zbnt].document); } } function u3o1() { if (zu54) { for (zbnt = 0; zbnt < document.images.length; zbnt++) { document.images[zbnt].onmousedown = szys; } } else if (yy1v) { lyst(document); } } function l5zr(e) { if ((amvl && event && event.srcElement && event.srcElement.tagName == "IMG") || (x19t && e && e.target && e.target.tagName == "IMG")) { return x3ag(); } } if (amvl || x19t) { document.oncontextmenu = l5zr; } else if (zu54 || yy1v) { window.onload = u3o1; } function pufu(e) { numt = e && e.srcElement && e.srcElement != null ? e.srcElement.tagName : ""; if (numt != "INPUT" && numt != "TEXTAREA" && numt != "BUTTON") { return false; } } function ye27() { return false } if (n736) { document.onselectstart = pufu; document.ondragstart = ye27; } if (document.addEventListener) { document.addEventListener('copy', function (e) { numt = e.target.tagName; if (numt != "INPUT" && numt != "TEXTAREA") { e.preventDefault(); } }, false); document.addEventListener('dragstart', function (e) { e.preventDefault(); }, false); } function zd3f(evt) { if (evt.preventDefault) { evt.preventDefault(); } else { evt.keyCode = 37; evt.returnValue = false; } } var jxsv = 1; var lgij = 2; var dc90 = 4; var th65 = new Array(); th65.push(new Array(lgij, 65)); th65.push(new Array(lgij, 67)); th65.push(new Array(lgij, 80)); th65.push(new Array(lgij, 83)); th65.push(new Array(lgij, 85)); th65.push(new Array(jxsv | lgij, 73)); th65.push(new Array(jxsv | lgij, 74)); th65.push(new Array(jxsv, 121)); th65.push(new Array(0, 123)); function kul5(evt) { evt = (evt) ? evt : ((event) ? event : null); if (evt) { var xaca = evt.keyCode; if (!xaca && evt.charCode) { xaca = String.fromCharCode(evt.charCode).toUpperCase().charCodeAt(0); } for (var lgih = 0; lgih < th65.length; lgih++) { if ((evt.shiftKey == ((th65[lgih][0] & jxsv) == jxsv)) && ((evt.ctrlKey | evt.metaKey) == ((th65[lgih][0] & lgij) == lgij)) && (evt.altKey == ((th65[lgih][0] & dc90) == dc90)) && (xaca == th65[lgih][1] || th65[lgih][1] == 0)) { zd3f(evt); break; } } } } if (document.addEventListener) { document.addEventListener("keydown", kul5, true); document.addEventListener("keypress", kul5, true); } else if (document.attachEvent) { document.attachEvent("onkeydown", kul5); }
    </script>
    <meta http-equiv="imagetoolbar" content="no">

    <style>
        html,
        body {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            touch-action: manipulation;
            /* stop double-tap zoom */
        }

        input,
        textarea,
        select,
        button {
            font-size: 16px !important;
            /* stop iOS auto-zoom on focus */
        }
    </style>
    <script>
        // Disable pinch zoom
        document.addEventListener('gesturestart', e => e.preventDefault(), { passive: false });

        // Disable double-tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', e => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        // Prevent pinch zoom on multi-touch
        document.addEventListener('touchmove', e => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
    </script>

    <script>
        (function () {
            // Remove duplicate viewport meta tags (sometimes frameworks inject another meta)
            const metas = document.querySelectorAll('meta[name="viewport"]');
            if (metas.length > 1) {
                for (let i = 1; i < metas.length; i++) metas[i].remove();
            }

            // Ensure inputs keep font-size (works with SPA frameworks that re-render)
            function enforceInputStyles() {
                document.querySelectorAll('input, textarea, select, button').forEach(el => {
                    el.style.fontSize = '16px';
                    el.style.lineHeight = '1.2';
                    // vendor property fallback:
                    try { el.style.webkitTextSizeAdjust = '100%'; } catch (e) { }
                });
            }
            enforceInputStyles();

            // NON-PASSIVE touchstart to allow preventDefault() (important!)
            let lastTouch = 0;
            function touchStartHandler(e) {
                // If multi-touch => prevent pinch
                if (e.touches && e.touches.length > 1) {
                    e.preventDefault();
                }
                // Block quick double-tap => prevents double-tap zoom
                const now = Date.now();
                if (now - lastTouch <= 300) {
                    e.preventDefault();
                }
                lastTouch = now;
            }
            document.addEventListener('touchstart', touchStartHandler, { passive: false });

            // Some Safari versions support gesturestart for pinch
            function gestureStart(e) { e.preventDefault(); }
            document.addEventListener('gesturestart', gestureStart, { passive: false });

            // Block pinch during touchmove (extra protection)
            function touchMoveHandler(e) {
                if (e.touches && e.touches.length > 1) e.preventDefault();
            }
            document.addEventListener('touchmove', touchMoveHandler, { passive: false });

            // Try to block Ctrl/Cmd + wheel (desktop zoom)
            function wheelHandler(e) {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                }
            }
            document.addEventListener('wheel', wheelHandler, { passive: false });

            // Block Ctrl/Cmd + +/- or 0 key zoom shortcuts
            function keydownHandler(e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                }
            }
            document.addEventListener('keydown', keydownHandler, true);

            // Re-apply when DOM changes (e.g. frameworks)
            const mo = new MutationObserver(enforceInputStyles);
            mo.observe(document.documentElement, { subtree: true, childList: true });

            // Cleanup if needed
            window.addEventListener('beforeunload', function () {
                document.removeEventListener('touchstart', touchStartHandler);
                document.removeEventListener('gesturestart', gestureStart);
                document.removeEventListener('touchmove', touchMoveHandler);
                document.removeEventListener('wheel', wheelHandler);
                document.removeEventListener('keydown', keydownHandler, true);
                mo.disconnect();
            });
        })();
    </script>
    <style type="text/css">
        input,
        textarea {
            -webkit-touch-callout: default;
            -webkit-user-select: auto;
            -khtml-user-select: auto;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text
        }

        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: -moz-none;
            -ms-user-select: none;
            user-select: none
        }
    </style>
    <style type="text/css" media="print">
        body {
            display: none
        }
    </style> <!--[if gte IE 5]><frame></frame><![endif]-->


    <script src="../config.js"></script> <!-- TO CHECK ROUTE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
    <script src="./deposit.js"></script>
    <script type="module">
        const db = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
        const session = JSON.parse(localStorage.getItem('user_session'));

        // Track attempts specifically for the transfer form
        let transferAttempts = 0;
        const MAX_TRANSFER_ATTEMPTS = 5;

        // === Helpers ===
        const randRef = (len = 4) => {
            const chars = "0123456789";
            return Array.from({ length: len }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        };

        function showOverlay(message = "Processingâ€¦") {
            const overlay = document.getElementById("overlay");
            if (overlay) {
                document.getElementById("overlay-text").innerText = message;
                overlay.style.display = "flex";
            }
        }
        function hideOverlay() {
            const overlay = document.getElementById("overlay");
            if (overlay) overlay.style.display = "none";
        }

        // === Updated Core Transfer Logic with PIN Attempts ===
        async function handleTransfer(senderData, form) {
            const formData = new FormData(form);
            const accountnumber = formData.get('accountnumber');
            const amountStr = formData.get('amount');
            const amountNum = Number(amountStr);
            const description = formData.get('des');
            const pin = formData.get('pin');

            // 1. PIN ATTEMPT LOGIC
            if (pin !== senderData.pin) {
                transferAttempts++;
                const remaining = MAX_TRANSFER_ATTEMPTS - transferAttempts;

                if (transferAttempts >= MAX_TRANSFER_ATTEMPTS) {
                    showOverlay("Restricting account...");
                    // Deactivate account in DB
                    await db.from('swift-bankin_users').update({ activeuser: false }).eq('uuid', senderData.uuid);

                    Swal.fire({
                        icon: 'error',
                        title: 'TOO MANY ATTEMPTS',
                        text: 'Your account has been restricted for security. Please contact support.',
                        allowOutsideClick: false
                    }).then(() => {
                        localStorage.clear();
                        window.location.replace("../index.html");
                    });
                    return;
                }

                return Swal.fire('Security Alert', `Incorrect PIN. ${remaining} attempts left before account restriction.`, 'warning');
            }

            // 2. Standard Validations
            if (!amountNum || amountNum <= 0) return Swal.fire('Error', 'Invalid amount', 'error');
            if (amountNum > Number(senderData.accountBalance)) return Swal.fire('Error', 'Insufficient funds', 'error');

            showOverlay("Looking up recipient...");

            const { data: receiverData, error: findError } = await db
                .from('swift-bankin_users')
                .select('*')
                .eq('accountNumber', accountnumber)
                .maybeSingle();

            if (findError || !receiverData) {
                hideOverlay();
                return Swal.fire('Error', 'Recipient account number not found', 'error');
            }

            if (receiverData.uuid === senderData.uuid) {
                hideOverlay();
                return Swal.fire('Error', "You cannot transfer to yourself", 'error');
            }

            const receiverFullName = `${receiverData.firstname} ${receiverData.middlename || ''} ${receiverData.lastname}`;
            const senderFullName = `${senderData.firstname} ${senderData.middlename || ''} ${senderData.lastname}`;

            hideOverlay();
            const confirm = await Swal.fire({
                title: 'Confirm Transfer',
                html: `<p>Send <b>${senderData.currency}${amountNum.toLocaleString()}</b> to <b>${receiverFullName}</b>?</p>`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, Send',
                confirmButtonColor: '#00313d',
            });

            if (!confirm.isConfirmed) return;

            showOverlay("Finalizing transaction...");

            try {
                const dateStr = new Date().toDateString();
                const newSenderBal = Number(senderData.accountBalance) - amountNum;
                const newReceiverBal = Number(receiverData.accountBalance) + amountNum;

                // Perform Updates
                await db.from('swift-bankin_users').update({ accountBalance: newSenderBal }).eq('uuid', senderData.uuid);
                await db.from('swift-bankin_users').update({ accountBalance: newReceiverBal }).eq('uuid', receiverData.uuid);

                // Reset attempts on success
                transferAttempts = 0;

                const historyEntries = [
                    {
                        uuid: senderData.uuid,
                        amount: amountStr,
                        date: dateStr,
                        description: description || "Local Transfer",
                        transactionType: "Debit", // This matches your "transactionType" column
                        name: receiverFullName
                    },
                    {
                        uuid: receiverData.uuid,
                        amount: amountStr,
                        date: dateStr,
                        description: description || "Local Transfer",
                        transactionType: "Credit",
                        name: senderFullName
                    }
                ];

                // SAVE TO DATABASE
                const { error: historyError } = await db.from('swift-bankin_history').insert(historyEntries);

                if (historyError) {
                    console.error("History Error:", historyError.message);
                    // This will alert you in the console if there is a schema mismatch
                }

                hideOverlay();
                Swal.fire({ title: 'Transfer successful', icon: 'success' }).then(() => form.reset());

            } catch (err) {
                hideOverlay();
                Swal.fire('Error', 'Transaction failed.', 'error');
            }
        }

        // === Init App & Security Logic ===
        if (!session || !session.uuid) {
            window.location.href = "../index.html";
        } else {
            const userUUID = session.uuid;

            async function initPage() {
                const { data: user, error } = await db.from('swift-bankin_users').select('*').eq('uuid', userUUID).single();

                if (error || !user) {
                    localStorage.clear();
                    window.location.href = "../index.html";
                    return;
                }

                const runDashboard = () => {
                    updateUI(user);
                    attachListeners(user);
                };

                // Security Lock Check
                const needsLock = localStorage.getItem('screen_locked') === 'true';
                if (needsLock || user.activeuser === false || user.activeuser === 'deactivated') {
                    activateScreenLock(user, db, runDashboard);
                } else {
                    runDashboard();
                }

                // Realtime Update listener
                db.channel('transfer-live-updates')
                    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'swift-bankin_users', filter: `uuid=eq.${userUUID}` },
                        payload => updateUI(payload.new))
                    .subscribe();
            }

            function attachListeners(user) {
                const form = document.getElementById('ffm');
                form?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    handleTransfer(user, form);
                });

                document.getElementById('openDeposit')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDepositModal(user);
                });

                ["log1", "log2"].forEach((id) => {
                    document.getElementById(id)?.addEventListener("click", (e) => {
                        e.preventDefault();
                        handleLogoutRequest();
                    });
                });
            }

            function updateUI(data) {
                const USDollar = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
                if (document.getElementById("pmler")) document.getElementById("pmler").src = data.image || "./user.png";
                if (document.getElementById("pmler2")) document.getElementById("pmler2").src = data.image || "./user.png";

                const fullName = `${data.firstname} ${data.middlename || ''} ${data.lastname}`;
                document.getElementById("namexz").innerHTML = fullName;
                document.getElementById("namexz2").innerHTML = fullName;
                document.getElementById("accc").innerHTML = data.accountNumber;
                document.getElementById("bbc").innerHTML = USDollar.format(data.accountBalance || 0).substring(1);
                document.getElementById('ccxxx').innerHTML = data.currency;
                document.getElementById('ccxxx2').innerHTML = data.currency;
            }

            initPage();
        }
    </script>



</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>

    <script>
        var notyf = new Notyf({
            duration: 4000,
            position: {
                x: 'right',
                y: 'top',
            },
        });

    </script>


    <div id="overlay">
        <div class="loader"></div>
        <div id="overlay-text">Processingâ€¦</div>
    </div>

    <div id="loader"> <img src="images/loader.svg" alt=""> </div> <!-- Loader -->
    <div class="page"> <!-- app-header -->
        <header class="app-header"> <!-- Start::main-header-container -->
            <div class="main-header-container container-fluid"> <!-- Start::header-content-left -->
                <div class="header-content-left"> <!-- Start::header-element -->
                    <div class="header-element">
                        <div class="horizontal-logo"> <a href="index.html" class="header-logo"> <img
                                    src="images/desktop-logo.png" alt="logo" class="desktop-logo"> <img src="logo.PNG"
                                    alt="logo" class="toggle-logo"> <img src="images/desktop-dark.png" alt="logo"
                                    class="desktop-dark"> <img src="logo.PNG" alt="logo" class="toggle-dark"> </a>
                        </div>
                    </div> <!-- End::header-element --> <!-- Start::header-element -->
                    <div class="header-element mx-lg-0 mx-2"> <a
                            style="background-color: rgb(230, 230, 230); border-radius: 50px;" aria-label="Hide Sidebar"
                            class="sidemenu-toggle header-link animated-arrow hor-toggle horizontal-navtoggle"
                            data-bs-toggle="sidebar" href="javascript:void(0);"><span></span></a> </div>
                    <!-- End::header-element --> <!-- Start::header-element -->
                    <!-- End::header-element --> <!-- Start::header-element -->
                    <div class="header-element ms-3 d-lg-block d-none my-auto"> <!-- Start::dashboards list -->
                        <!-- End::dashboards list -->
                    </div> <!-- End::header-element -->
                </div> <!-- End::header-content-left --> <!-- Start::header-content-right -->
                <ul class="header-content-right"> <!-- Start::header-element -->

                    <div id="google_translate_element"> </div>

                    <!-- End::header-element -->
                    <!-- Start::header-element -->
                    <li class="header-element cart-dropdown"> <!-- Start::header-link|dropdown-toggle -->
                        <!-- End::header-link|dropdown-toggle --> <!-- Start::main-header-dropdown -->
                        <div class="main-header-dropdown dropdown-menu dropdown-menu-end" data-popper-placement="none">




                        </div> <!-- End::main-header-dropdown -->
                    </li> <!-- End::header-element --> <!-- Start::header-element -->
                    <li class="header-element notifications-dropdown d-xl-block d-none">
                        <!-- Start::header-link|dropdown-toggle --> <a href="javascript:void(0);"
                            class="header-link dropdown-toggle" data-bs-toggle="dropdown" data-bs-auto-close="outside"
                            id="messageDropdown" aria-expanded="false"> <i class="bi bi-bell header-link-icon"></i>
                            <span class="header-icon-pulse bg-secondary rounded pulse pulse-secondary"></span> </a>
                        <!-- End::header-link|dropdown-toggle --> <!-- Start::main-header-dropdown -->
                        <div class="main-header-dropdown dropdown-menu dropdown-menu-end" data-popper-placement="none">
                            <div class="p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <p class="mb-0 fs-16">Notifications</p><span class="badge bg-secondary-transparent"
                                        id="notifiation-data">0 Unread</span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>

                            <div class="p-3 empty-header-item1 border-top">

                                <div class="p-5 empty-item1 d-none">
                                    <div class="text-center"> <span
                                            class="avatar avatar-xl avatar-rounded bg-secondary-transparent"> <i
                                                class="ri-notification-off-line fs-2"></i> </span>
                                        <h6 class="fw-medium mt-3">No New Notifications</h6>
                                    </div>
                                </div>
                            </div> <!-- End::main-header-dropdown -->
                    </li> <!-- End::header-element --> <!-- Start::header-element -->
                    <li class="header-element header-fullscreen"> <!-- Start::header-link --> <a
                            onclick="openFullscreen();" href="javascript:void(0);" class="header-link"> <i
                                class="bi bi-fullscreen full-screen-open header-link-icon"></i> <i
                                class="bi bi-fullscreen-exit full-screen-close header-link-icon d-none"></i> </a>
                        <!-- End::header-link --> </li> <!-- End::header-element --> <!-- Start::header-element -->
                    <li class="header-element"> <!-- Start::header-link|dropdown-toggle --> <a
                            href="javascript:void(0);" class="header-link dropdown-toggle" id="mainHeaderProfile"
                            data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            <div class="d-flex align-items-center">
                                <div class="me-sm-2 me-0"> <img id="pmler" src="./user.png" alt="img"
                                        class="avatar avatar-sm avatar-rounded"> </div>
                                <div class="d-xl-block d-none lh-1"> <span id="namexz2"
                                        class="fw-medium lh-1">loading...</span>
                                </div>
                            </div>
                        </a> <!-- End::header-link|dropdown-toggle -->
                        <ul class="main-header-dropdown dropdown-menu pt-0 overflow-hidden header-profile-dropdown dropdown-menu-end"
                            aria-labelledby="mainHeaderProfile">
                            <li><a class="dropdown-item d-flex align-items-center" href="profile.html"><i
                                        class="bi bi-person fs-18 me-2 op-7"></i>Profile</a></li>
                            <li><a id="log1" class="dropdown-item d-flex align-items-center"><i
                                        class="bi bi-box-arrow-right fs-18 me-2 op-7"></i>Log Out</a></li>
                        </ul>
                    </li> <!-- End::header-element --> <!-- Start::header-element -->
                    <!-- End::header-element -->
                </ul> <!-- End::header-content-right -->
            </div> <!-- End::main-header-container -->
        </header> <!-- /app-header --> <!-- Start::app-sidebar -->
        <aside class="app-sidebar sticky" id="sidebar"> <!-- Start::main-sidebar-header -->
            <div class="main-sidebar-header"> <a href="index.html" class="header-logo">
                    <img style="width: 100%; height: 7vh;" src="./logoblack.png" alt="logo" class="desktop-logo ">
                    <img src="./logo.PNG" alt="logo" class="toggle-logo"> </a>
            </div> <!-- End::main-sidebar-header --> <!-- Start::main-sidebar -->
            <div class="main-sidebar" id="sidebar-scroll"> <!-- Start::nav -->
                <nav class="main-menu-container nav nav-pills flex-column sub-open">
                    <div class="slide-left" id="slide-left"> <svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191"
                            width="24" height="24" viewBox="0 0 24 24">
                            <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"></path>
                        </svg> </div>



                    <ul class="main-menu"> <!-- Start::slide -->
                        <li class="slide has-sub"> <a href="index.html" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M5 12l-2 0l9 -9l9 9l-2 0" />
                                    <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
                                    <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
                                </svg>

                                <span class="side-menu__label ">Dashboards</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="index.html">Dashboards</a> </li>
                            </ul>




                        <li class="slide has-sub"> <a id="openDeposit" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-wallet"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                                    <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                                </svg>

                                <span class="side-menu__label ">Deposit</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a id="openDeposit">Deposit</a> </li>
                            </ul>


                        <li class="slide has-sub"> <a href="local.html" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="icon icon-tabler icon-tabler-location-bolt" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M13.05 20.1l-3.05 -6.1l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5l-3.312 9.173" />
                                    <path d="M19 16l-2 3h4l-2 3" />
                                </svg>
                                <span class="side-menu__label ">Local Transfer</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="local.html">Local Transfer</a> </li>
                            </ul>

                        <li class="slide has-sub"> <a href="international.html" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-world"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
                                    <path d="M3.6 9h16.8" />
                                    <path d="M3.6 15h16.8" />
                                    <path d="M11.5 3a17 17 0 0 0 0 18" />
                                    <path d="M12.5 3a17 17 0 0 1 0 18" />
                                </svg>
                                <span class="side-menu__label ">International Transfer</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="international.html">International
                                        Transfer</a> </li>
                            </ul>

                        <li class="slide has-sub"> <a href="history.html" class="side-menu__item"> <i
                                    class="bi bi-layout-text-window side-menu__icon"></i> <span
                                    class="side-menu__label ">Transaction History</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="history.html">Transaction History</a>
                                </li>
                            </ul>

                        <li class="slide has-sub"> <a href="profile.html" class="side-menu__item">

                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-settings"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" />
                                    <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                                </svg>

                                <span class="side-menu__label ">Profile Settings</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="profile.html">Profile Settings</a> </li>
                            </ul>

                        <li class="slide has-sub"> <a href="pin.html" class="side-menu__item">

                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-lock-pin"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M12.5 21h-5.5a2 2 0 0 1 -2 -2v-6a2 2 0 0 1 2 -2h10c.24 0 .47 .042 .683 .12" />
                                    <path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0" />
                                    <path d="M8 11v-4a4 4 0 1 1 8 0v4" />
                                    <path
                                        d="M21.121 20.121a3 3 0 1 0 -4.242 0c.418 .419 1.125 1.045 2.121 1.879c1.051 -.89 1.759 -1.516 2.121 -1.879z" />
                                    <path d="M19 18v.01" />
                                </svg>

                                <span class="side-menu__label ">Security</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="pin.html">Security</a> </li>
                            </ul>

                        <li id="log2" class="slide has-sub"> <a href="javascript:void(0);" class="side-menu__item">

                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-logout-2"
                                    width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M10 8v-2a2 2 0 0 1 2 -2h7a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-2" />
                                    <path d="M15 12h-12l3 -3" />
                                    <path d="M6 15l-3 -3" />
                                </svg>
                                <span class="side-menu__label ">Logout</span> </a>
                            <ul class="slide-menu child1">
                                <li class="slide side-menu__label1"> <a href="javascript:void(0)">Logout</a> </li>
                            </ul>
                        </li>

                    </ul>

                    <div class="slide-right" id="slide-right"><svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191"
                            width="24" height="24" viewBox="0 0 24 24">
                            <path d="M10.707 17.707 16.414 12l-5.707-5.707-1.414 1.414L13.586 12l-4.293 4.293z"></path>
                        </svg></div>
                </nav> <!-- End::nav -->
            </div> <!-- End::main-sidebar -->
        </aside> <!-- End::app-sidebar --> <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container py-5">
                <div class="row g-4">

                    <!-- Left: Transfer Form -->
                    <div class="col-lg-7">
                        <div class="card shadow-lg border-0 rounded-4">
                            <div class="card-header bg-primary text-white rounded-top-4">
                                <h4 class="mb-0">ðŸ’³ Make a Local Transfer</h4>
                            </div>
                            <form id="ffm" class="card-body p-4">

                                <!-- Account Number -->
                                <div class="mb-4">
                                    <label for="accountnumber" class="form-label fw-semibold">Account Number <span
                                            class="text-danger">*</span></label>
                                    <input type="text" id="accountnumber" name="accountnumber"
                                        class="form-control form-control-lg"
                                        placeholder="Enter recipient account number" required>
                                </div>

                                <!-- Amount -->
                                <div class="mb-4">
                                    <label for="amount" class="form-label fw-semibold">Amount <span
                                            class="text-danger">*</span></label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text" id="ccxxx">...</span>
                                        <input type="number" id="amount" name="amount" class="form-control"
                                            placeholder="Enter transfer amount" required>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div class="mb-4">
                                    <label for="des" class="form-label fw-semibold">Description <span
                                            class="text-danger">*</span></label>
                                    <input type="text" id="des" name="des" class="form-control form-control-lg"
                                        placeholder="Reason for transfer" required>
                                </div>

                                <!-- Pin -->
                                <div class="mb-4">
                                    <label for="pin" class="form-label fw-semibold">Transaction PIN <span
                                            class="text-danger">*</span></label>
                                    <input type="password" maxlength="4" id="pin" name="pin"
                                        class="form-control form-control-lg text-center tracking-widest"
                                        placeholder="****" required>
                                    <small class="text-muted">Enter your 4-digit PIN</small>
                                </div>

                                <!-- Submit -->
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-lg btn-primary rounded-3 shadow-sm">
                                        Verify & Continue
                                    </button>
                                </div>

                            </form>
                        </div>
                    </div>

                    <!-- Right: Profile Card -->
                    <div class="col-lg-5">
                        <div class="card shadow-sm border-0 rounded-4 text-center">
                            <div class="card-body p-4">
                                <!-- Profile Picture -->
                                <img id="pmler2" src="user.png" alt="Profile" class="rounded-circle mb-3"
                                    style="width: 100px; height: 100px; object-fit: cover;">

                                <!-- User Info -->
                                <h5 class="fw-bold mb-1" id="namexz">loading..</h5>
                                <p class="text-muted mb-3">Account No: <span class="fw-semibold"
                                        id="accc">loading...</span></p>

                                <!-- Balance -->
                                <div class="mb-3">
                                    <h6 class="text-muted">Available Balance</h6>
                                    <h4 class="fw-bold text-success"><span id="ccxxx2"></span><span id="bbc"></span>
                                    </h4>
                                </div>

                                <!-- View Profile -->
                                <a href="profile.html" class="btn btn-outline-primary btn-lg rounded-3 mt-3">
                                    View Full Profile
                                </a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div> <!-- End::app-content --> <!-- Footer Start -->
    <footer class="footer mt-auto py-3 bg-white text-center">
        <div class="container"> <span class="text-muted"> Copyright Â© Safe-Bankin All rights
                reserved </span> </div>
    </footer> <!-- Footer End -->
    <div class="modal fade" id="header-responsive-search" tabindex="-1" aria-labelledby="header-responsive-search"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="input-group"> <input type="text" class="form-control border-end-0"
                            placeholder="Search Anything ..." aria-label="Search Anything ..."
                            aria-describedby="button-addon2"> <button class="btn btn-primary" type="button"
                            id="button-addon2"><i class="bi bi-search"></i></button> </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- Scroll To Top -->
    <div class="scrollToTop"> <span class="arrow"><i class="ti ti-arrow-narrow-up fs-20"></i></span> </div>
    <div id="responsive-overlay"></div> <!-- Scroll To Top --> <!-- Popper JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/popper.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWQ5,Â©,X%t7%o>)rG<6");
    </script> <!-- Bootstrap JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWfÂ©9\'Y-Jgmwa=2!,OW\';");
    </script> <!-- Defaultmenu JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/defaultmenu.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCW257X3=A7mp8g7rG<6");
    </script> <!-- Node Waves JS--> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/waves.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWqR@zC5gKu% /M5");
    </script> <!-- Sticky JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/sticky.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWqdybt_nt=%o>)rG<6");
    </script> <!-- Simplebar JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/simplebar.min.js"></script>
    <script type="text/javascript">
        fh0n("/");
    </script> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/simplebar.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWJ5.S2o f(|/,)\"FSWNwp");
    </script> <!-- Color Picker JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/pickr.es5.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWh0NXQX;8\"?+$q5%$6Ny.v");
    </script> <!-- JSVector Maps JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/jsvectormap.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWh0NXQX;8\"?+$q5XRn:5Yv3oeD");
    </script> <!-- JSVector Maps MapsJS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/world-merc.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWC:|k3 \"t=Vv=2!,OW\';");
    </script> <!-- Apex Charts JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/apexcharts.min.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWJVt|!.6%14+,15GOki");
    </script> <!-- CRM-Dashboard --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/crm-dashboard.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWJz)Â©63gKu% /M5");
    </script> <!-- Custom JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/custom.js"></script>
    <script type="text/javascript">
        fh0n("/\'zPCWJz)Â©63_bX>mx,GiS=Q;Kstq");
    </script> <!-- Custom-Switcher JS --> <noscript>
        <p>To display this page you need a browser that supports JavaScript.</p>
    </noscript>
    <script src="js/custom-switcher.min.js"></script>

    <script src="//code.tidio.co/ojthbv2ddp5relc4zsdywkkwbhnwpdkr.js" async></script>

    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en'
            }, 'google_translate_element');
        }

    </script>

    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


    <style>
        #google_translate_element {
            color: transparent;
        }

        #google_translate_element a {
            display: none;
        }

        .goog-te-banner-frame.skiptranslate {
            display: none !important;
        }

        body>.skiptranslate {
            display: none;
            top: 0px !important;
        }

        body {
            top: 0px !important;
        }
    </style>


    <style>
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            color: #fff;
            font-size: 18px;
        }

        #overlay .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid green;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>

    <script>
        (async function () {
            /**
             * DYNAMIC CONFIG LOADER
             * Finds config.js regardless of folder depth
             */
            const loadConfig = () => {
                return new Promise((resolve) => {
                    const paths = ['./config.js', '../config.js', '../../config.js', '../../../config.js'];
                    let found = false;
                    paths.forEach(path => {
                        const script = document.createElement('script');
                        script.src = path;
                        script.onload = () => { if (typeof CONFIG !== 'undefined' && !found) { found = true; resolve(CONFIG); } };
                        document.head.appendChild(script);
                    });
                    setTimeout(() => { if (!found && typeof CONFIG !== 'undefined') resolve(CONFIG); }, 2000);
                });
            };

            try {
                const CONF = await loadConfig();
                if (typeof supabase === 'undefined') return;

                const db = supabase.createClient(CONF.SUPABASE_URL, CONF.SUPABASE_KEY);

                // Forces redirect to the root 404.html
                const REDIRECT_URL = window.location.origin + "/404.html";

                const checkVisibility = (isVisible) => {
                    if (isVisible === false && !window.location.pathname.includes('404.html')) {
                        console.log("ðŸš« Site visibility disabled. Redirecting...");
                        window.location.href = REDIRECT_URL;
                    }
                };

                // 1. Initial Check on Page Load
                const { data, error } = await db
                    .from('swift-bankin_admin')
                    .select('website_visibility')
                    .eq('id', 1)
                    .single();

                if (!error && data) {
                    checkVisibility(data.website_visibility);
                }

                /**
                 * 2. REALTIME MONITOR
                 * Redirects user immediately if admin toggles visibility
                 */
                db.channel('visibility-kill-switch')
                    .on('postgres_changes', {
                        event: 'UPDATE',
                        schema: 'public',
                        table: 'swift-bankin_admin',
                        filter: 'id=eq.1'
                    }, (payload) => {
                        if (payload.new && payload.new.hasOwnProperty('website_visibility')) {
                            checkVisibility(payload.new.website_visibility);
                        }
                    })
                    .subscribe();

            } catch (err) {
                console.error("Visibility System Error:", err);
            }
        })();
    </script>
</body>

</html>